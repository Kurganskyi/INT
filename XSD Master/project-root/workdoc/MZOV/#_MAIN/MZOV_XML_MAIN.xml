<?xml version="1.0" encoding="utf-8"?>
<Process xmlns="http://www.netvoxlab.ru/ReDoc/Workflow/Api" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:st="http://www.netvoxlab.ru/ReDoc/Workflow/SimpleTask" xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/DynamicForm" xmlns:pdf="http://www.netvoxlab.ru/ReDoc/Workflow/GeneratePdf" xmlns:stcc="http://www.netvoxlab.ru/ReDoc/Workflow/SimpleCallCenterTask" xmlns:tkmv="http://www.netvoxlab.ru/ReDoc/Workflow/TKMV" xmlns:sir="http://www.netvoxlab.ru/ReDoc/Workflow/RunUslugaInSIR" xmlns:indoc="http://www.netvoxlab.ru/ReDoc/Workflow/UploadDocsForm" xmlns:outdoc="http://www.netvoxlab.ru/ReDoc/Workflow/ResultNote" xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xmlns:send="http://www.netvoxlab.ru/ReDoc/Workflow/SendSoap" xmlns:rr="http://www.netvoxlab.ru/ReDoc/Workflow/Rosreestr" ArchiveAfterEnd="true">
    <Name>Оказание услуги</Name>
    <Name>Кострома СФР. Новая услуга (МЗОВ). АС. </Name>
    <Start Step="TemplateApplication"/>
    <!--Загрузка документов из цели-->
    <Step Name="TemplateApplication">
        <Transition Title="Далее" To="info_talon"/>
        <Data xmlns:ch="http://www.netvoxlab.ru/ReDoc/Workflow/ApplicationTemplate" xsi:type="ch:ApplicationTemplateData"/>
    </Step>
    <Step Name="info_talon">
        <Transition Title="Готово" To="WriteToRequestRegister_Ticket"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/DynamicForm" xsi:type="df:DynamicFormData">
            <df:IdRef>DF_talon</df:IdRef>
            <df:Title>Заполнить данные о талоне</df:Title>
            <df:Duration>1440</df:Duration>
        </Data>
    </Step>
    <!--Шаг записи в реестр ИС МДМ статус Ticket - Формирование талона-->
    <Step Name="WriteToRequestRegister_Ticket">
        <Transition Title="Передача данных в реестр ИС МДМ" To="WriteToRequestRegister_TicketIssued"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/WriteRegisterData" xsi:type="df:WriteRegisterData">
            <df:RegistryKey>Nvx.ReDoc.FileStatusRegistryModule.Web.Model.Registry.FileStatusRegistryRecord</df:RegistryKey>
            <df:Title>Передача данных в реестр ИС МДМ</df:Title>
            <!-- <df:Restriction>Id==${serviceRecord.Id}</df:Restriction>-->
            <df:Template>
<![CDATA[
                <document>
                    <RecId>${FileInfo.FileId}</RecId>
                    <Number>${FileInfo.Identificator}</Number>
                    <StatusId>Ticket</StatusId> 
#if ("$!TemplateApplication.IsMdmId" !="")<ServiceId>${TemplateApplication.IsMdmId}</ServiceId>#end
                    <OrganizationId>${CompanyCode}</OrganizationId>
#if ("$!DepartmentConfig.MfcUuid" !="")<MfcUuid>${DepartmentConfig.MfcUuid}</MfcUuid>#end
                    <Attributes>{"ticket_timestamp": "${info_talon.date_talon} ${info_talon.take_talon}"}</Attributes>
                </document>]]>            </df:Template>
            <df:VarDataOut>serviceRecord</df:VarDataOut>
            <df:Duration>10</df:Duration>
        </Data>
    </Step>
    <!--Шаг записи в реестр ИС МДМ статус TicketIssued - Выдача талона-->
    <Step Name="WriteToRequestRegister_TicketIssued">
        <Transition Title="Передача данных в реестр ИС МДМ" To="WriteToRequestRegister_TicketCalled"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/WriteRegisterData" xsi:type="df:WriteRegisterData">
            <df:RegistryKey>Nvx.ReDoc.FileStatusRegistryModule.Web.Model.Registry.FileStatusRegistryRecord</df:RegistryKey>
            <df:Title>Передача данных в реестр ИС МДМ</df:Title>
            <!-- <df:Restriction>Id==${serviceRecord.Id}</df:Restriction>-->
            <df:Template>
<![CDATA[
                <document>
                    <RecId>${FileInfo.FileId}</RecId>
                    <Number>${FileInfo.Identificator}</Number>
                    <StatusId>TicketIssued</StatusId>
#if ("$!TemplateApplication.IsMdmId" !="")<ServiceId>${TemplateApplication.IsMdmId}</ServiceId>#end
                    <OrganizationId>${CompanyCode}</OrganizationId>
#if ("$!DepartmentConfig.MfcUuid" !="")<MfcUuid>${DepartmentConfig.MfcUuid}</MfcUuid>#end
                   <Attributes>{"ticket_issued_timestamp": "${info_talon.date_talon} ${info_talon.take_talon}"}</Attributes>                   
                </document>]]>            </df:Template>
            <df:VarDataOut>serviceRecord</df:VarDataOut>
            <df:Duration>10</df:Duration>
        </Data>
    </Step>
    <!--Шаг записи в реестр ИС МДМ статус TicketCalled - Вызов талона-->
    <Step Name="WriteToRequestRegister_TicketCalled">
        <Transition Title="Передача данных в реестр ИС МДМ" To="WriteToRequestRegister_TicketResult"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/WriteRegisterData" xsi:type="df:WriteRegisterData">
            <df:RegistryKey>Nvx.ReDoc.FileStatusRegistryModule.Web.Model.Registry.FileStatusRegistryRecord</df:RegistryKey>
            <df:Title>Передача данных в реестр ИС МДМ</df:Title>
            <!-- <df:Restriction>Id==${serviceRecord.Id}</df:Restriction>-->
            <df:Template>
<![CDATA[
                <document>
                    <RecId>${FileInfo.FileId}</RecId>
                    <Number>${FileInfo.Identificator}</Number>
                    <StatusId>TicketCalled</StatusId>
#if ("$!TemplateApplication.IsMdmId" !="")<ServiceId>${TemplateApplication.IsMdmId}</ServiceId>#end        
                    <OrganizationId>${CompanyCode}</OrganizationId>
#if ("$!DepartmentConfig.MfcUuid" !="")<MfcUuid>${DepartmentConfig.MfcUuid}</MfcUuid>#end
                   <Attributes>{"ticket_called_timestamp": "${info_talon.date_talon} ${info_talon.call_talon}","window_id": "${info_talon.num_okno}"}</Attributes>
                </document>]]>            </df:Template>
            <df:VarDataOut>serviceRecord</df:VarDataOut>
            <df:Duration>10</df:Duration>
        </Data>
    </Step>
    <!--Шаг записи в реестр ИС МДМ статус TicketResult - Завершение обработки талона-->
    <Step Name="WriteToRequestRegister_TicketResult">
        <Transition Title="Передача данных в реестр ИС МДМ" To="WriteToRequestRegister_ReceptionStarted"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/WriteRegisterData" xsi:type="df:WriteRegisterData">
            <df:RegistryKey>Nvx.ReDoc.FileStatusRegistryModule.Web.Model.Registry.FileStatusRegistryRecord</df:RegistryKey>
            <df:Title>Передача данных в реестр ИС МДМ</df:Title>
            <!-- <df:Restriction>Id==${serviceRecord.Id}</df:Restriction>-->
            <df:Template>
<![CDATA[
                <document>
                    <RecId>${FileInfo.FileId}</RecId>
                    <Number>${FileInfo.Identificator}</Number>
                    <StatusId>TicketResult</StatusId>
#if ("$!TemplateApplication.IsMdmId" !="")<ServiceId>${TemplateApplication.IsMdmId}</ServiceId>#end        
                    <OrganizationId>${CompanyCode}</OrganizationId>
#if ("$!DepartmentConfig.MfcUuid" !="")<MfcUuid>${DepartmentConfig.MfcUuid}</MfcUuid>#end
                   <Attributes>{}</Attributes>
                </document>]]>            </df:Template>
            <df:VarDataOut>serviceRecord</df:VarDataOut>
            <df:Duration>10</df:Duration>
        </Data>
    </Step>
    <!--Шаг записи в реестр ИС МДМ статус ReceptionStarted - Начало процесса регистрации запроса на услугу-->
    <Step Name="WriteToRequestRegister_ReceptionStarted">
        <Transition Title="Передача данных в реестр ИС МДМ" To="form0"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/WriteRegisterData" xsi:type="df:WriteRegisterData">
            <df:RegistryKey>Nvx.ReDoc.FileStatusRegistryModule.Web.Model.Registry.FileStatusRegistryRecord</df:RegistryKey>
            <df:Title>Передача данных в реестр ИС МДМ</df:Title>
            <!-- <df:Restriction>Id==${serviceRecord.Id}</df:Restriction>-->
            <df:Template>
<![CDATA[
                <document>
                    <RecId>${FileInfo.FileId}</RecId>
                    <Number>${FileInfo.Identificator}</Number>
                    <StatusId>ReceptionStarted</StatusId>
#if ("$!TemplateApplication.IsMdmId" !="")<ServiceId>${TemplateApplication.IsMdmId}</ServiceId>#end                    
                    <OrganizationId>${CompanyCode}</OrganizationId>
#if ("$!DepartmentConfig.MfcUuid" !="")<MfcUuid>${DepartmentConfig.MfcUuid}</MfcUuid>#end
                    <Attributes>{"window_id": "${info_talon.num_okno}"}</Attributes>
                </document>]]>            </df:Template>
            <df:VarDataOut>serviceRecord</df:VarDataOut>
            <df:Duration>10</df:Duration>
        </Data>
    </Step>
    <!--тест -->
    <Step Name="form0">
        <Transition Title="Перейти к подготовке заявления" To="velocity1"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/DynamicForm" xsi:type="df:DynamicFormData">
            <df:IdRef>PFR_MZOV_44</df:IdRef>
            <df:Title>Заполнить данные</df:Title>
            <df:Duration>480</df:Duration>
        </Data>
    </Step>
    <Step Name="velocity1">
        <Transition Title="Далее" To="null"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTestData"/>
    </Step>
    <Step Name="vt_receipt">
        <Transition Title="Далее" To="pdf_rec"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[#set($f="False")
<document>
	<pfr>
		<pfr>#if (${form0.pfr.pfr})${form0.pfr.pfr}#end</pfr>
		<reg_n>#if (${form0.pfr.reg_n})${form0.pfr.reg_n}#end</reg_n>
		<date_z>#if (${form0.pfr.date_z})${form0.pfr.date_z}#end</date_z>
		<n>#if (${form0.pfr.n})${form0.pfr.n}#end</n>
		<namePFR_txt>#if (${form0.pfr.namePFR_txt})${form0.pfr.namePFR_txt}#end</namePFR_txt>
		<okato>#if (${form0.pfr.okato})${form0.pfr.okato}#end</okato>
		<oktmo>#if (${form0.pfr.oktmo})${form0.pfr.oktmo}#end</oktmo>
		<code>#if (${form0.pfr.code})${form0.pfr.code}#end</code>
		<code1>#if (${form0.pfr.code1})${form0.pfr.code1}#end</code1>
	</pfr>
	<InfoPanel>
		<stat>#if (${form0.InfoPanel.stat})${form0.InfoPanel.stat}#end</stat>
		<F_Applicant>#if (${form0.InfoPanel.F_Applicant})${form0.InfoPanel.F_Applicant}#end</F_Applicant>
		<f_pri_r>#if (${form0.InfoPanel.f_pri_r})${form0.InfoPanel.f_pri_r}#end</f_pri_r>
		<I_Applicant>#if (${form0.InfoPanel.I_Applicant})${form0.InfoPanel.I_Applicant}#end</I_Applicant>
		<Ot_Applicant>#if (${form0.InfoPanel.Ot_Applicant})${form0.InfoPanel.Ot_Applicant}#end</Ot_Applicant>
		<date_birth>#if (${form0.InfoPanel.date_birth})${form0.InfoPanel.date_birth}#end</date_birth>
		<snils>#if (${form0.InfoPanel.snils})${form0.InfoPanel.snils}#end</snils>
		<phone>#if (${form0.InfoPanel.phone})${form0.InfoPanel.phone}#end</phone>
		<address_manual>#if (${form0.InfoPanel.address_manual})${form0.InfoPanel.address_manual}#else$f#end</address_manual>
		<adr_reg_zayv>#if (${form0.InfoPanel.adr_reg_zayv})${form0.InfoPanel.adr_reg_zayv}#end</adr_reg_zayv>
		<address_type>#if (${form0.InfoPanel.address_type})${form0.InfoPanel.address_type}#end</address_type>
		<adr_reg_zayv_fias>#if (${form0.InfoPanel.adr_reg_zayv_fias})${form0.InfoPanel.adr_reg_zayv_fias}#end</adr_reg_zayv_fias>
		<adr_fact_zayv_fias>#if (${form0.InfoPanel.adr_fact_zayv_fias})${form0.InfoPanel.adr_fact_zayv_fias}#end</adr_fact_zayv_fias>
		<adr_preb_zayv_fias>#if (${form0.InfoPanel.adr_preb_zayv_fias})${form0.InfoPanel.adr_preb_zayv_fias}#end</adr_preb_zayv_fias>
	</InfoPanel>
	<PasData>
		<SelectTypeDoc>#if (${form0.PasData.SelectTypeDoc})${form0.PasData.SelectTypeDoc}#end</SelectTypeDoc>
		<NameDoc>#if (${form0.PasData.NameDoc})${form0.PasData.NameDoc}#end</NameDoc>
		<Seria>#if (${form0.PasData.Seria})${form0.PasData.Seria}#end</Seria>
		<Number>#if (${form0.PasData.Number})${form0.PasData.Number}#end</Number>
		<Seria_p>#if (${form0.PasData.Seria_p})${form0.PasData.Seria_p}#end</Seria_p>
		<Number_p>#if (${form0.PasData.Number_p})${form0.PasData.Number_p}#end</Number_p>
		<DatePas>#if (${form0.PasData.DatePas})${form0.PasData.DatePas}#end</DatePas>
		<srok_d>#if (${form0.PasData.srok_d})${form0.PasData.srok_d}#end</srok_d>
		<kod_pdr>#if (${form0.PasData.kod_pdr})${form0.PasData.kod_pdr}#end</kod_pdr>
		<PassBy>#if (${form0.PasData.PassBy})${form0.PasData.PassBy}#end</PassBy>
	</PasData>
	<certificate_info>
		<seria>#if (${form0.certificate_info.seria})${form0.certificate_info.seria}#end</seria>
		<number>#if (${form0.certificate_info.number})${form0.certificate_info.number}#end</number>
		<issued_date>#if (${form0.certificate_info.issued_date})${form0.certificate_info.issued_date}#end</issued_date>
		<issued_by>#if (${form0.certificate_info.issued_by})${form0.certificate_info.issued_by}#end</issued_by>
		<code>#if (${form0.certificate_info.code})${form0.certificate_info.code}#end</code>
		<duplicate>#if (${form0.certificate_info.duplicate})${form0.certificate_info.duplicate}#else$f#end</duplicate>
	</certificate_info>
	<predst>
		<TypeDecl>#if (${form0.predst.TypeDecl})${form0.predst.TypeDecl}#end</TypeDecl>
		<StatusDecl>#if (${form0.predst.StatusDecl})${form0.predst.StatusDecl}#end</StatusDecl>
		<F_decl>#if (${form0.predst.F_decl})${form0.predst.F_decl}#end</F_decl>
		<I_decl>#if (${form0.predst.I_decl})${form0.predst.I_decl}#end</I_decl>
		<Ot_decl>#if (${form0.predst.Ot_decl})${form0.predst.Ot_decl}#end</Ot_decl>
		<Mesto_b>#if (${form0.predst.Mesto_b})${form0.predst.Mesto_b}#end</Mesto_b>
		<date_b>#if (${form0.predst.date_b})${form0.predst.date_b}#end</date_b>
		<snils>#if (${form0.predst.snils})${form0.predst.snils}#end</snils>
		<grajdanstvo>#if (${form0.predst.grajdanstvo})${form0.predst.grajdanstvo}#end</grajdanstvo>
		<grajdanstvo_txt>#if (${form0.predst.grajdanstvo_txt})${form0.predst.grajdanstvo_txt}#end</grajdanstvo_txt>
		<address_manual>#if (${form0.predst.address_manual})${form0.predst.address_manual}#else$f#end</address_manual>
		<adr_reg_pred>#if (${form0.predst.adr_reg_pred})${form0.predst.adr_reg_pred}#end</adr_reg_pred>
		<address_type>#if (${form0.predst.address_type})${form0.predst.address_type}#end</address_type>
		<adr_reg_pred_fias>#if (${form0.predst.adr_reg_pred_fias})${form0.predst.adr_reg_pred_fias}#end</adr_reg_pred_fias>
		<adr_fact_pred_fias>#if (${form0.predst.adr_fact_pred_fias})${form0.predst.adr_fact_pred_fias}#end</adr_fact_pred_fias>
		<adr_preb_pred_fias>#if (${form0.predst.adr_preb_pred_fias})${form0.predst.adr_preb_pred_fias}#end</adr_preb_pred_fias>
		<phone_n>#if (${form0.predst.phone_n})${form0.predst.phone_n}#end</phone_n>
		<pochta>#if (${form0.predst.pochta})${form0.predst.pochta}#end</pochta>
		<PasData>
			<select_doc>#if (${form0.predst.PasData.select_doc})${form0.predst.PasData.select_doc}#end</select_doc>
			<Seria>#if (${form0.predst.PasData.Seria})${form0.predst.PasData.Seria}#end</Seria>
			<Number>#if (${form0.predst.PasData.Number})${form0.predst.PasData.Number}#end</Number>
			<date_v_pr>#if (${form0.predst.PasData.date_v_pr})${form0.predst.PasData.date_v_pr}#end</date_v_pr>
			<srok_d>#if (${form0.predst.PasData.srok_d})${form0.predst.PasData.srok_d}#end</srok_d>
			<kod_pdr>#if (${form0.predst.PasData.kod_pdr})${form0.predst.PasData.kod_pdr}#end</kod_pdr>
			<kem_v>#if (${form0.predst.PasData.kem_v})${form0.predst.PasData.kem_v}#end</kem_v>
		</PasData>
		<Sved_poln>
			<Polnom_pr>#if (${form0.predst.Sved_poln.Polnom_pr})${form0.predst.Sved_poln.Polnom_pr}#end</Polnom_pr>
			<Seria>#if (${form0.predst.Sved_poln.Seria})${form0.predst.Sved_poln.Seria}#end</Seria>
			<Number>#if (${form0.predst.Sved_poln.Number})${form0.predst.Sved_poln.Number}#end</Number>
			<datee_v>#if (${form0.predst.Sved_poln.datee_v})${form0.predst.Sved_poln.datee_v}#end</datee_v>
			<sr_pol>#if (${form0.predst.Sved_poln.sr_pol})${form0.predst.Sved_poln.sr_pol}#end</sr_pol>
			<kem_vdn>#if (${form0.predst.Sved_poln.kem_vdn})${form0.predst.Sved_poln.kem_vdn}#end</kem_vdn>
		</Sved_poln>
		<recv>
			<name>#if (${form0.predst.recv.name})${form0.predst.recv.name}#end</name>
			<jur_address>#if (${form0.predst.recv.jur_address})${form0.predst.recv.jur_address}#end</jur_address>
			<fact_address>#if (${form0.predst.recv.fact_address})${form0.predst.recv.fact_address}#end</fact_address>
			<bank_finorg>#if (${form0.predst.recv.bank_finorg})${form0.predst.recv.bank_finorg}#end</bank_finorg>
			<inn>#if (${form0.predst.recv.inn})${form0.predst.recv.inn}#end</inn>
			<ogrn>#if (${form0.predst.recv.ogrn})${form0.predst.recv.ogrn}#end</ogrn>
			<kpp>#if (${form0.predst.recv.kpp})${form0.predst.recv.kpp}#end</kpp>
			<bik>#if (${form0.predst.recv.bik})${form0.predst.recv.bik}#end</bik>
			<ras_chet>#if (${form0.predst.recv.ras_chet})${form0.predst.recv.ras_chet}#end</ras_chet>
			<cor_chet>#if (${form0.predst.recv.cor_chet})${form0.predst.recv.cor_chet}#end</cor_chet>
			<phone>#if (${form0.predst.recv.phone})${form0.predst.recv.phone}#end</phone>
			<email>#if (${form0.predst.recv.email})${form0.predst.recv.email}#end</email>
		</recv>
	</predst>
	<uk_n_v>
		<reason>#if (${form0.uk_n_v.reason})${form0.uk_n_v.reason}#end</reason>
		<date1>#if (${form0.uk_n_v.date1})${form0.uk_n_v.date1}#end</date1>
		<date2>#if (${form0.uk_n_v.date2})${form0.uk_n_v.date2}#end</date2>
		<date3>#if (${form0.uk_n_v.date3})${form0.uk_n_v.date3}#end</date3>
		<reg_num>#if (${form0.uk_n_v.reg_num})${form0.uk_n_v.reg_num}#end</reg_num>
		<operator>#if (${form0.uk_n_v.operator})${form0.uk_n_v.operator}#end</operator>
	</uk_n_v>
</document>]]>            </vt:Template>
            <vt:SetVariable>XmlDataModel1</vt:SetVariable>
        </Data>
    </Step>
    <Step Name="pdf_rec">
        <Transition To="vt_QR" Title="1"/>
        <Data xmlns:pdf="http://www.netvoxlab.ru/ReDoc/Workflow/GeneratePdf" xsi:type="pdf:GeneratePdfData">
            <pdf:XSLTTemplateId>MZOV_xslt_44</pdf:XSLTTemplateId>
            <pdf:VarNameWithDataXML>XmlDataModel1</pdf:VarNameWithDataXML>
            <pdf:OutputAttach>Заявление.PDF</pdf:OutputAttach>
        </Data>
    </Step>
    <!-- Записываем необходимые данные в переменную для генерации QR-кода -->
    <Step Name="vt_QR">
        <Transition Title="Далее" To="QrGenerate"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[https://www.mfc44.ru/status-dela/index.php?guid=${FileInfo.FileId}]]>            </vt:Template>
            <vt:SetVariable>QRvar</vt:SetVariable>
        </Data>
    </Step>
    <!-- QrGenerator — Шаг генерации QR кодов и прочих штриховых кодов -->
    <Step Name="QrGenerate">
        <Transition Title="Далее" To="document"/>
        <Data xmlns:s2="http://www.netvoxlab.ru/ReDoc/Workflow/QrGenerator" xsi:type="s2:QrGeneratorData">
            <s2:VarName>QRvar</s2:VarName>
            <!-- Название переменной контекста с данными для кодирования -->
            <s2:QrCodeAttachmentName>QRcode.jpg</s2:QrCodeAttachmentName>
            <!-- Название генерируемого файла картинки с QR-кодом -->
            <s2:UseTempFolder>true</s2:UseTempFolder>
        </Data>
    </Step>
    <!--Шаг сбора доков и велосити передачи данных в xml для формирования расписки -->
    <Step Name="document">
        <Transition Title="Собрать документы" To="ReceptionEnded"/>
        <Data xmlns:uf="http://www.netvoxlab.ru/ReDoc/Workflow/UploadDocsForm" xsi:type="uf:UploadDocsFormData">
            <uf:Title>Собрать документы</uf:Title>
            <uf:Duration>7200</uf:Duration>
            <uf:XMLTemplate>
<![CDATA[#set($f="False")
<document>
  <DepartmentPhone>#if (${TemplateApplication.DepartmentPhone})${TemplateApplication.DepartmentPhone}#end</DepartmentPhone>
<ExecutiveName>#if(${TemplateApplication.DepartmentName})${TemplateApplication.DepartmentName}#end</ExecutiveName>
  <DepartmentName>#if (${DepartmentConfig.DepartmentName})${DepartmentConfig.DepartmentName}#end</DepartmentName>
  <DepartmentAdr>#if (${DepartmentConfig.DepartmentAddress})${DepartmentConfig.DepartmentAddress}#end</DepartmentAdr>
  <TypeBenefitType1>
    <type_benefit>#if (${TemplateApplication.serviceFullName})${TemplateApplication.serviceFullName}#end</type_benefit>
  </TypeBenefitType1>
  <Gender>#if (${Customer.Gender})${Customer.Gender}#end</Gender>
  <CustomerType>#if (${Customer.CustomerType})${Customer.CustomerType}#end</CustomerType>
  <TypeApplInfo1>
    <surname_applicant>#if (${Customer.Name.Last})${Customer.Name.Last}#end</surname_applicant>
    <name_applicant>#if (${Customer.Name.First})${Customer.Name.First}#end</name_applicant>
    <patronymic_applicant>#if (${Customer.Name.Middle})${Customer.Name.Middle}#end</patronymic_applicant>
    <phone_applicant>#if (${Customer.Contacts.Phone3})${Customer.Contacts.Phone3}#end</phone_applicant>
<Phone1>#if (${Customer.Contacts.Phone1})${Customer.Contacts.Phone1}#end</Phone1>
<Phone2>#if (${Customer.Contacts.Phone2})${Customer.Contacts.Phone2}#end</Phone2>
<Phone3>#if (${Customer.Contacts.Phone3})${Customer.Contacts.Phone3}#end</Phone3>
    <CompanyFullName>#if (${Customer.CompanyFullName})${Customer.CompanyFullName}#end</CompanyFullName>
    <DirectorName>#if (${Customer.DirectorName.ToString()})${Customer.DirectorName.ToString()}#end</DirectorName>    
    #if (${Customer.AddressRegistrationManual} == "True")<TypeAddrInfo2>#if (${Customer.RegistrationAddress.ToString()})${Customer.RegistrationAddress.ToString()}#end</TypeAddrInfo2>#else <TypeAddrInfo2>#if (${Customer.RegistrationFiasAddress.ToString()})${Customer.RegistrationFiasAddress.ToString()}#end</TypeAddrInfo2>#end
      <Document>
        <type>#if (${Customer.DisplayDocType})${Customer.DisplayDocType}#end</type>
        <ser>#if (${Customer.Passport.Series})${Customer.Passport.Series}#end</ser>
        <num>#if (${Customer.Passport.Number})${Customer.Passport.Number}#end</num>
        <date>#if (${Customer.Passport.IssueDate})${Customer.Passport.IssueDate}#end</date>
        <issuer>#if (${Customer.Passport.IssuedBy})${Customer.Passport.IssuedBy}#end</issuer>
      </Document>
  </TypeApplInfo1>
  <TypeResultInform1>
    <fio_operator>#if (${CurrentUserName})${CurrentUserName}#end</fio_operator>
</TypeResultInform1>
  <identificator>${FileInfo.Identificator}</identificator>
  <attachments>
    #foreach ($attach in $Attachs)
    #each
      <item size="${attach.CountPage}" isOrigin="${attach.IsOrigin}">${attach.Alias}</item>
    #end
  </attachments>
  <date_now>#if (${DateNow})${DateNow}#end</date_now>
</document>]]>            </uf:XMLTemplate>
            <uf:FileNamesReadonly>true</uf:FileNamesReadonly>
            <uf:XSLTIdRef>PDF_RECEIPT_IN_44_MFC_NEW</uf:XSLTIdRef>
            <uf:ImageDirVar>QrGenerateTempFolder</uf:ImageDirVar>
        </Data>
    </Step>
    <Step Name="ReceptionEnded">
        <Transition Title="Далее" To="mkgu1"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Документы приняты от заявителя</fs:Description>
                <fs:MfcServiceStatus>ReceptionEnded</fs:MfcServiceStatus>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="mkgu1">
        <Transition To="vt1" Title="Инициация оценки"/>
        <Data xmlns:st="http://www.netvoxlab.ru/ReDoc/Workflow/MkguTask" xsi:type="st:MkguTaskData">
            <st:Title>Инициация оценки</st:Title>
            <st:Duration>60</st:Duration>
            <st:Ask>true</st:Ask>
            <st:XMLTemplate>
<![CDATA[<document>
		<AuthorizationKey>#if (${Card.AuthorizationKey})${Card.AuthorizationKey}#end</AuthorizationKey>
		<DeclarantName>#if (${Card.DeclarantName})${Card.DeclarantName}#end</DeclarantName>
		<StartServiceDate>#if (${Card.StartServiceDate})${Card.StartServiceDate}#end</StartServiceDate>
		<ServiceName>#if (${Card.ServiceName})${Card.ServiceName}#end</ServiceName>
		<SubServiceName>#if (${Card.SubServiceName})${Card.SubServiceName}#end</SubServiceName>
		<DepartmentName>#if (${Card.DepartmentName})${Card.DepartmentName}#end</DepartmentName>
		<CurrentDate>#if (${Card.CurrentDate})${Card.CurrentDate}#end</CurrentDate>
		</document>]]>            </st:XMLTemplate>
            <st:XSLTIdRef>MKGU_CARD</st:XSLTIdRef>
        </Data>
    </Step>
    <Step Name="vt1">
        <Transition Title="Далее" To="vt_xml_name"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<ЭДСФР
  xmlns="http://пф.рф/ВВ/МСК/МЗОВ/2024-01-01"
  xmlns:АФ7="http://пф.рф/АФ/2023-04-03"
  xmlns:УТ7="http://пф.рф/УТ/2023-04-03"
  xmlns:ПР8="http://пф.рф/Представитель/2024-01-01"
  xmlns:ns1="http://www.w3.org/2000/09/xmldsig#"
  xmlns:sig="http://iis.ecp.ru/SignInfo/2023-01-10"
>
  <МЗОВ>
    <ТОСФР>
      <УТ7:Код>${form0.pfr.ut7_code}</УТ7:Код>
      <УТ7:Наименование>${form0.pfr.namePFR_txt}</УТ7:Наименование>
    </ТОСФР>
    <Заявитель>
      <УТ7:ФИО>
        <УТ7:Фамилия>${form0.InfoPanel.F_Applicant}</УТ7:Фамилия>
        <УТ7:Имя>${form0.InfoPanel.I_Applicant}</УТ7:Имя>
        <УТ7:Отчество>${form0.InfoPanel.Ot_Applicant}</УТ7:Отчество>
      </УТ7:ФИО>
      <УТ7:СНИЛС>${form0.InfoPanel.snils}</УТ7:СНИЛС>
      <УТ7:УдостоверяющийДокумент>
        <УТ7:Код>
          #if (${form0.PasData.code_txt}=="Паспорт гражданина РФ")27
          #elseif (${form0.PasData.code_txt}=="Свидетельство о рождении гражданина РФ")3
          #else
          0
          #end
        </УТ7:Код>
        <УТ7:Серия>${form0.PasData.Seria}</УТ7:Серия>
        <УТ7:Номер>${form0.PasData.Number}</УТ7:Номер>
        <УТ7:ДатаВыдачи>${form0.PasData.DatePas.ToString("yyyy-MM-dd")}</УТ7:ДатаВыдачи>
        <УТ7:КемВыдан>${form0.PasData.PassBy}</УТ7:КемВыдан>
        <УТ7:КодПодразделения>${form0.PasData.KodPodr}</УТ7:КодПодразделения>
      </УТ7:УдостоверяющийДокумент>
      <УТ7:ДатаРождения>${form0.InfoPanel.date_birth.ToString("yyyy-MM-dd")}</УТ7:ДатаРождения>
      <УТ7:Телефон>${form0.InfoPanel.phone}</УТ7:Телефон>
      #if(${form0.InfoPanel.email})
        <УТ7:АдресЭлПочты>${form0.InfoPanel.email}</УТ7:АдресЭлПочты>
      #end
    </Заявитель>
    <СертифицируемыйРебенок>
      <УТ7:ФИО>
        <УТ7:Фамилия>${form0.child.F}</УТ7:Фамилия>
        <УТ7:Имя>${form0.child.I}</УТ7:Имя>
        <УТ7:Отчество>${form0.child.Ot}</УТ7:Отчество>
      </УТ7:ФИО>
      <УТ7:СНИЛС>${form0.child.snils}</УТ7:СНИЛС>
      <УТ7:ДатаРождения>${form0.child.date_birth.ToString("yyyy-MM-dd")}</УТ7:ДатаРождения>
    </СертифицируемыйРебенок>
    #if(${form0.representative})
      <Представитель>
        <ПР8:АнкетныеДанные>
          <УТ7:ФИО>
            <УТ7:Фамилия>${form0.representative.F}</УТ7:Фамилия>
            <УТ7:Имя>${form0.representative.I}</УТ7:Имя>
            <УТ7:Отчество>${form0.representative.Ot}</УТ7:Отчество>
          </УТ7:ФИО>
          <УТ7:СНИЛС>${form0.representative.snils}</УТ7:СНИЛС>
          <УТ7:Телефон>${form0.representative.phone}</УТ7:Телефон>
          #if(${form0.representative.email})
            <УТ7:АдресЭлПочты>${form0.representative.email}</УТ7:АдресЭлПочты>
          #end
          <УТ7:УдостоверяющийДокумент>
            <УТ7:Код>${form0.representative.PasData.code}</УТ7:Код>
            <УТ7:Серия>${form0.representative.PasData.Seria}</УТ7:Серия>
            <УТ7:Номер>${form0.representative.PasData.Number}</УТ7:Номер>
            <УТ7:ДатаВыдачи>${form0.representative.PasData.DatePas.ToString("yyyy-MM-dd")}</УТ7:ДатаВыдачи>
            <УТ7:КемВыдан>${form0.representative.PasData.PassBy}</УТ7:КемВыдан>
            <УТ7:КодПодразделения>${form0.representative.PasData.KodPodr}</УТ7:КодПодразделения>
          </УТ7:УдостоверяющийДокумент>
          <УТ7:ДатаРождения>${form0.representative.date_birth.ToString("yyyy-MM-dd")}</УТ7:ДатаРождения>
        </ПР8:АнкетныеДанные>
        <ПР8:Тип>
          <ПР8:ДоверенноеЛицо>${form0.representative.type}</ПР8:ДоверенноеЛицо>
        </ПР8:Тип>
        <УТ7:ДокументПодтверждающийПолномочия>
          <УТ7:Код>${form0.representative.DocPower.code}</УТ7:Код>
          <УТ7:Серия>${form0.representative.DocPower.Seria}</УТ7:Серия>
          <УТ7:Номер>${form0.representative.DocPower.Number}</УТ7:Номер>
          <УТ7:ДатаВыдачи>${form0.representative.DocPower.DatePas.ToString("yyyy-MM-dd")}</УТ7:ДатаВыдачи>
          <УТ7:КемВыдан>${form0.representative.DocPower.PassBy}</УТ7:КемВыдан>
        </УТ7:ДокументПодтверждающийПолномочия>
      </Представитель>
    #end
    <ДатаЗаполнения>${form0.pfr.date_z.ToString("yyyy-MM-dd")}</ДатаЗаполнения>
  </МЗОВ>
  #if(${form0.service_info})
    <СлужебнаяИнформация>
      <АФ7:GUID>${form0.service_info.guid}</АФ7:GUID>
      <АФ7:ДатаВремя>${form0.service_info.datetime}</АФ7:ДатаВремя>
    </СлужебнаяИнформация>
  #end
</ЭДСФР>         
]]>            </vt:Template>
            <vt:Encoding>Utf8</vt:Encoding>
            <vt:OutputAttach>pfr_${FileInfo.FileId}.xml</vt:OutputAttach>
        </Data>
    </Step>
    <Step Name="vt_xml_name">
        <Transition Title="Далее" To="xml_validation"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[pfr_${FileInfo.FileId}.xml]]>            </vt:Template>
            <vt:SetVariable>xml_name</vt:SetVariable>
        </Data>
    </Step>
    <Step Name="xml_validation">
        <Transition Title="Далее" To="createRequest"/>
        <Data xmlns:st="http://www.netvoxlab.ru/ReDoc/Workflow/SendSoap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="st:SoapXsdValidationData">
            <st:Id>MZOV_2021-10-26</st:Id>
            <st:AttachmentId>${xml_name}</st:AttachmentId>
        </Data>
    </Step>
    <!-- формирование запроса -->
    <Step Name="createRequest">
        <Transition Title="Далее" To="Application"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<ns0:Request xmlns:cmv08="urn://cmv.pfr.ru/types/1.0.8" xmlns:ns0="urn://cmv.pfr.ru/mzaz/1.1.0">
	<cmv08:SNILS>${form0.InfoPanel.snils.Replace("-","").Replace(" ","")}</cmv08:SNILS>
	<cmv08:ExternalRegistrationData>
		<cmv08:ExternalRegistrationNumber>${FileInfo.Identificator}</cmv08:ExternalRegistrationNumber>
		<cmv08:ExternalRegistrationDate>${DateNow.substring(0,10)}</cmv08:ExternalRegistrationDate>
	</cmv08:ExternalRegistrationData>
	<cmv08:OKATO>#if (${form0.pfr.okato})${form0.pfr.okato}#end</cmv08:OKATO>
	<cmv08:OKTMO>#if (${form0.pfr.oktmo})${form0.pfr.oktmo}#end</cmv08:OKTMO>
	<cmv08:MFCCode>4440100010000000067</cmv08:MFCCode>
	<cmv08:ApplicationFileName>pfr_${FileInfo.FileId}.xml</cmv08:ApplicationFileName>
	<ns0:FRGUTargetId>354988153</ns0:FRGUTargetId>
</ns0:Request>
]]>            </vt:Template>
            <vt:SetVariable>PFR_MZOV_SOAPRequest.xml</vt:SetVariable>
        </Data>
    </Step>
    <Step Name="Application">
        <Transition Title="Далее" To="file"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Начало оказания услуги</fs:Description>
                <fs:MfcServiceStatus>Application</fs:MfcServiceStatus>
            </fs:CommonInfo>
        </Data>
    </Step>
    <!-- делаем дело общедоступным -->
    <Step Name="file">
        <Transition Title="Далее" To="ServiceProcessingStarted"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:IsPublic>true</fs:IsPublic>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="ServiceProcessingStarted">
        <Transition Title="Далее" To="sendRequest"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Заявление отправлено в ведомство</fs:Description>
                <fs:MfcServiceStatus>ServiceProcessingStarted</fs:MfcServiceStatus>
            </fs:CommonInfo>
        </Data>
    </Step>
    <!-- отправка запроса -->
    <Step Name="sendRequest">
        <Transition Title="Далее" To="vars"/>
        <Data xmlns:send="http://www.netvoxlab.ru/ReDoc/Workflow/SendSoap" xsi:type="send:SendSoapData">
            <send:TaskTitle>Отправка запроса Заявление об аннулировании ранее поданного заявления о распоряжении средствами (частью средств) материнского (семейного) капитала (МЗАЗ)</send:TaskTitle>
            <send:Duration>480</send:Duration>
            <send:VariableWithRequest>PFR_MZOV_SOAPRequest.xml</send:VariableWithRequest>
            <send:BusinessProcessMetadata>BusinessProcessMetadataWithFrgu</send:BusinessProcessMetadata>
            <send:SaveResponseToVariable>PFR_MZOV_SOAPResponse.xml</send:SaveResponseToVariable>
            <send:NeedAttachFiles>true</send:NeedAttachFiles>
            <send:SendFilesRegex>^.+\.xml$</send:SendFilesRegex>
            <!--<send:Endpoint>http://smev3-n0.test.gosuslugi.ru:7500/ws</send:Endpoint>-->
            <!--адрес теста-->
            <send:Endpoint>http://172.20.3.12:7500/ws</send:Endpoint>
            <!--адрес прода-->
            <send:SaopAction>urn:SendRequest</send:SaopAction>
            <send:SignOV/>
            <send:CheckResponseSign>false</send:CheckResponseSign>
            <send:MR>MR300</send:MR>
            <send:ReadResponse send:Variable="SmevMessageType" send:XPath=".//ns2:MessageMetadata/ns2:MessageType">
                <send:Namespace send:Uri="urn://x-artefacts-smev-gov-ru/services/message-exchange/types/1.1" send:Alias="ns2"/>
            </send:ReadResponse>
            <send:ReadResponse send:Variable="Fault" send:XPath=".//s:Fault/faultstring">
                <send:Namespace send:Uri="http://schemas.xmlsoap.org/soap/envelope/" send:Alias="s"/>
            </send:ReadResponse>
            <send:ReadAnyResponse send:Variable="Status_PFR" send:XPath=".//cmv08:ProcessingStatusCode">
                <send:Namespace send:Uri="urn://cmv.pfr.ru/types/1.0.8" send:Alias="cmv08"/>
            </send:ReadAnyResponse>
            <send:EndTaskSmev3SuccessCondition>
<![CDATA[(Status_PFR == "3"|| Status_PFR == "4"|| Status_PFR == "24")]]>            </send:EndTaskSmev3SuccessCondition>
            <send:GenerateProcess>
                <send:ReadCondition send:Variable="ProcessingStatusCode" send:XPath=".//ns0:Response[cmv08:ProcessingStatusCode='24']/cmv08:ProcessingStatusCode">
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/mzaz/1.1.0" send:Alias="ns0"/>
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/types/1.0.8" send:Alias="cmv08"/>
                </send:ReadCondition>
                <send:WorkflowProcessId>ПФР статус МЗОВ</send:WorkflowProcessId>
                <send:XmlContextVarName>XML_PFR_Status</send:XmlContextVarName>
            </send:GenerateProcess>
            <send:GenerateProcess>
                <send:ReadCondition send:Variable="ProcessingStatusCode" send:XPath=".//ns0:Response[cmv08:ProcessingStatusCode='1']/cmv08:ProcessingStatusCode">
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/mzaz/1.1.0" send:Alias="ns0"/>
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/types/1.0.8" send:Alias="cmv08"/>
                </send:ReadCondition>
                <send:WorkflowProcessId>ПФР статус МЗОВ</send:WorkflowProcessId>
                <send:XmlContextVarName>XML_PFR_Status</send:XmlContextVarName>
            </send:GenerateProcess>
            <send:GenerateProcess>
                <send:ReadCondition send:Variable="ProcessingStatusCode" send:XPath=".//ns0:Response[cmv08:ProcessingStatusCode='6']/cmv08:ProcessingStatusCode">
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/mzaz/1.1.0" send:Alias="ns0"/>
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/types/1.0.8" send:Alias="cmv08"/>
                </send:ReadCondition>
                <send:WorkflowProcessId>ПФР статус МЗОВ</send:WorkflowProcessId>
                <send:XmlContextVarName>XML_PFR_Status</send:XmlContextVarName>
            </send:GenerateProcess>
            <send:GenerateProcess>
                <send:ReadCondition send:Variable="ProcessingStatusCode" send:XPath=".//ns0:Response[cmv08:ProcessingStatusCode='7']/cmv08:ProcessingStatusCode">
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/mzaz/1.1.0" send:Alias="ns0"/>
                    <send:Namespace send:Uri="urn://cmv.pfr.ru/types/1.0.8" send:Alias="cmv08"/>
                </send:ReadCondition>
                <send:WorkflowProcessId>ПФР статус МЗОВ</send:WorkflowProcessId>
                <send:XmlContextVarName>XML_PFR_Status</send:XmlContextVarName>
            </send:GenerateProcess>
            <send:Autorun>true</send:Autorun>
            <send:AutoRepeat>false</send:AutoRepeat>
            <!--<send:IsTestMessage>true</send:IsTestMessage>-->
        </Data>
    </Step>
    <Step Name="vars">
        <Transition Title="Далее" To="pdf1"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[<Request>#if (${form0.InfoPanel.F_Applicant})
	<param>
		<name>ФИО заявителя:</name>
		<value>#if (${form0.InfoPanel.F_Applicant})${form0.InfoPanel.F_Applicant}#end#if(${form0.InfoPanel.I_Applicant})${form0.InfoPanel.I_Applicant}#end#if(${form0.InfoPanel.Ot_Applicant})${form0.InfoPanel.Ot_Applicant}#end</value>
	</param>
	#end#if(${form0.InfoPanel.snils})
	<param>
		<name>СНИЛС:</name>
		<value>${form0.InfoPanel.snils.Replace("-","").Replace(" ","")}</value>
	</param>
	#end #if(${FileInfo.Identificator})
	<param>
		<name>Регистрационный номер обращения:</name>
		<value>${FileInfo.Identificator}</value>
	</param>
	#end
</Request>
]]>            </vt:Template>
            <vt:SetVariable>vars</vt:SetVariable>
        </Data>
    </Step>
    <!-- Формирование PDF с результатом по статусу заявки -->
    <Step Name="pdf1">
        <Transition To="result_choice" Title="1"/>
        <Data xmlns:pdf="http://www.netvoxlab.ru/ReDoc/Workflow/GeneratePdf" xsi:type="pdf:GeneratePdfData">
            <pdf:XSLTTemplateId>MZAZ_Response</pdf:XSLTTemplateId>
            <pdf:AttachNameWithDataXML>PFR_MZOV_SOAPResponse.xml</pdf:AttachNameWithDataXML>
            <pdf:OutputAttach>Статус заявки.pdf</pdf:OutputAttach>
            <pdf:AddContextVariables>true</pdf:AddContextVariables>
            <pdf:SignPdf>PFR_MZOV_SOAPResponse.xml</pdf:SignPdf>
        </Data>
    </Step>
    <Step Name="result_choice">
        <Transition Title="Готово" To="decision_result_choice"/>
        <Data xmlns:df="http://www.netvoxlab.ru/ReDoc/Workflow/DynamicForm" xsi:type="df:DynamicFormData">
            <df:IdRef>Decision_result</df:IdRef>
            <df:Title>Заполнить данные о результате</df:Title>
            <df:Duration>60</df:Duration>
        </Data>
    </Step>
    <Step xsi:type="Decision" Name="decision_result_choice">
        <Transition Title="1" To="221_result">
            <Condition>
                <Expression>"1" == result_choice.result</Expression>
            </Condition>
        </Transition>
        <Transition Title="2" To="222_result">
            <Condition>
                <Expression>"2" == result_choice.result</Expression>
            </Condition>
        </Transition>
        <Transition Title="3" To="223_result">
            <Condition>
                <Expression>"3" == result_choice.result</Expression>
            </Condition>
        </Transition>
        <Transition Title="4" To="224_result">
            <Condition>
                <Expression>"4" == result_choice.result</Expression>
            </Condition>
        </Transition>
        <Data/>
    </Step>
    <Step Name="221_result">
        <Transition Title="Далее" To="callCenter"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Готов положительный ответ</fs:Description>
                <fs:MfcResult>221</fs:MfcResult>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="222_result">
        <Transition Title="Далее" To="callCenter"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Готов отрицательный ответ (отказ)</fs:Description>
                <fs:MfcResult>222</fs:MfcResult>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="223_result">
        <Transition Title="Далее" To="ServiceProcessingEnded2"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Ошибка при отправке</fs:Description>
                <fs:MfcResult>223</fs:MfcResult>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="224_result">
        <Transition Title="Далее" To="ServiceProcessingEnded2"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Ошибка при отправке</fs:Description>
                <fs:MfcResult>223</fs:MfcResult>
            </fs:CommonInfo>
        </Data>
    </Step>
    <!--Задача call-центра с подтверждением и инфой о заявителе -->
    <Step Name="callCenter">
        <Transition To="ServiceProcessingEnded" Title="Подтвердить информирование"/>
        <Data xmlns:cc="http://www.netvoxlab.ru/ReDoc/Workflow/SimpleCallCenterTask" xsi:type="cc:SimpleCallCenterTaskData">
            <cc:Title>Сообщить о результате заявителю</cc:Title>
            <cc:Duration>480</cc:Duration>
        </Data>
    </Step>
    <Step Name="ServiceProcessingEnded">
        <Transition Title="Далее" To="form3"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Результат готов к выдаче</fs:Description>
                <fs:MfcServiceStatus>ServiceProcessingEnded</fs:MfcServiceStatus>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="form3">
        <Transition Title="Получить расписку" To="mkgu"/>
        <Transition Title="Заявитель не явился за результатом" To="ServiceResultsReceived" Action="Cancel"/>
        <Data xmlns:rn="http://www.netvoxlab.ru/ReDoc/Workflow/ResultNote" xsi:type="rn:ResultNoteData">
            <rn:Title>Выдать результат заявителю</rn:Title>
            <rn:Duration>43200</rn:Duration>
            <rn:XMLTemplate>
<![CDATA[<document> 
	<TypeMFCInfo1>
		<name_mfc>#if (${DepartmentConfig.DepartmentName})${DepartmentConfig.DepartmentName}#end</name_mfc>
		<address_mfc>#if (${DepartmentConfig.DepartmentAddress})${DepartmentConfig.DepartmentAddress}#end</address_mfc>
		<email_mfc>#if (${DepartmentConfig.DepartmentEmail})${DepartmentConfig.DepartmentEmail}#end</email_mfc>
		<phone_mfc>#if (${DepartmentConfig.DepartmentPhone})${DepartmentConfig.DepartmentPhone}#end</phone_mfc> 
	</TypeMFCInfo1>
	<DepartmentPhone>#if (${TemplateApplication.DepartmentPhone})${TemplateApplication.DepartmentPhone}#end</DepartmentPhone>
<ExecutiveName>#if(${TemplateApplication.DepartmentName})${TemplateApplication.DepartmentName}#end</ExecutiveName>
	<DepartmentName>#if (${TemplateApplication.DepartmentName})${TemplateApplication.DepartmentName}#end</DepartmentName>
	<Gender>#if (${Customer.Gender})${Customer.Gender}#end</Gender>
	<CustomerType>#if (${Customer.CustomerType})${Customer.CustomerType}#end</CustomerType>
	<TypeBenefitType1>
		<type_benefit>#if (${TemplateApplication.serviceFullName})${TemplateApplication.serviceFullName}#end</type_benefit>
	</TypeBenefitType1>
	<TypeApplInfo1>
		<DisplayDocType_applicant>#if (${Customer.DisplayDocType})${Customer.DisplayDocType}#end</DisplayDocType_applicant>
		<Series_applicant>#if (${Customer.Passport.Series})${Customer.Passport.Series}#end</Series_applicant>
		<Number_applicant>#if (${Customer.Passport.Number})${Customer.Passport.Number}#end</Number_applicant>
		<IssueDate_applicant>#if (${Customer.Passport.IssueDate})${Customer.Passport.IssueDate.ToString("%tdd.%tMM.%tyyyy")}#end</IssueDate_applicant>
		<IssuedBy_applicant>#if (${Customer.Passport.IssuedBy})${Customer.Passport.IssuedBy}#end</IssuedBy_applicant>
		<IssuedByCode_applicant>#if (${Customer.Passport.IssuedByCode})${Customer.Passport.IssuedByCode}#end</IssuedByCode_applicant>
		<surname_applicant>#if (${Customer.Name.Last})${Customer.Name.Last}#end</surname_applicant>
		<name_applicant>#if (${Customer.Name.First})${Customer.Name.First}#end</name_applicant>
		<patronymic_applicant>#if (${Customer.Name.Middle})${Customer.Name.Middle}#end</patronymic_applicant>
		<CompanyFullName>#if (${Customer.CompanyFullName})${Customer.CompanyFullName}#end</CompanyFullName>
		<DirectorName>#if (${Customer.RepresentativeName.ToString()})${Customer.RepresentativeName.ToString()}#end</DirectorName>
#if ("$!Customer.RegistrationAddress.ToString()" !="")
		<TypeAddrInfo2>${Customer.RegistrationAddress.ToString()}</TypeAddrInfo2>#end
#if ("$!Customer.RegistrationFiasAddress.ToString()" !="")
		<TypeAddrInfo2>${Customer.RegistrationFiasAddress.ToString()}</TypeAddrInfo2>#end
#if ("$!Customer.FacticalAddress.ToString()" !="")
		<TypeAddrInfo2>${Customer.FacticalAddress.ToString()}</TypeAddrInfo2>#end
#if ("$!Customer.FacticalFiasAddress.ToString()" !="")
		<TypeAddrInfo2>${Customer.FacticalFiasAddress.ToString()}</TypeAddrInfo2>#end
	</TypeApplInfo1>
	<Customers>
		#foreach ($Customer in ${CustomerList})
		#each
		<Customer>
			<Gender>#if (${Customer.Gender})${Customer.Gender}#end</Gender>
			<CustomerType>#if (${Customer.CustomerType})${Customer.CustomerType}#end</CustomerType>
			<surname_applicant>#if (${Customer.Name.Last})${Customer.Name.Last}#end</surname_applicant>
			<name_applicant>#if (${Customer.Name.First})${Customer.Name.First}#end</name_applicant>
			<patronymic_applicant>#if (${Customer.Name.Middle})${Customer.Name.Middle}#end</patronymic_applicant>
			<CompanyFullName>#if (${Customer.CompanyFullName})${Customer.CompanyFullName}#end</CompanyFullName>
			<DirectorName>#if (${Customer.DirectorName.ToString()})${Customer.DirectorName.ToString()}#end</DirectorName>
			<TypeAddrInfo2>#if (${Customer.RegistrationAddress.ToString()})${Customer.RegistrationAddress.ToString()}#end</TypeAddrInfo2>
		</Customer>
		#end
	</Customers>
	<TypeResultInform1>
		<fio_operator>${CurrentUserName}</fio_operator>
	</TypeResultInform1>
	<createdAt>${FileInfo.CreatedAt.ToString("O")}</createdAt>
	<identificator>${FileInfo.Identificator}</identificator>
	<attachments>
  #foreach ($attach in $Attachs)
  #each
		<item size="${attach.CountPage}" isOrigin="${attach.IsOrigin}">${attach.Title}</item> 
  #end
	</attachments>    
	<date_now>${DateNow}</date_now>
</document>]]>            </rn:XMLTemplate>
            <rn:XSLTIdRef>PDF_RECEIPT_OUT_44_MFC</rn:XSLTIdRef>
        </Data>
    </Step>
    <Step Name="mkgu">
        <Transition To="ServiceResultsReceived" Title="Инициация оценки"/>
        <Data xmlns:st="http://www.netvoxlab.ru/ReDoc/Workflow/MkguTask" xsi:type="st:MkguTaskData">
            <st:Title>Инициация оценки</st:Title>
            <st:Duration>60</st:Duration>
            <st:Ask>true</st:Ask>
            <st:XMLTemplate>
<![CDATA[<document>
		<AuthorizationKey>#if (${Card.AuthorizationKey})${Card.AuthorizationKey}#end</AuthorizationKey>
		<DeclarantName>#if (${Card.DeclarantName})${Card.DeclarantName}#end</DeclarantName>
		<StartServiceDate>#if (${Card.StartServiceDate})${Card.StartServiceDate}#end</StartServiceDate>
		<ServiceName>#if (${Card.ServiceName})${Card.ServiceName}#end</ServiceName>
		<SubServiceName>#if (${Card.SubServiceName})${Card.SubServiceName}#end</SubServiceName>
		<DepartmentName>#if (${Card.DepartmentName})${Card.DepartmentName}#end</DepartmentName>
		<CurrentDate>#if (${Card.CurrentDate})${Card.CurrentDate}#end</CurrentDate>
		</document>]]>            </st:XMLTemplate>
            <st:XSLTIdRef>MKGU_CARD</st:XSLTIdRef>
        </Data>
    </Step>
    <Step Name="ServiceResultsReceived">
        <Transition Title="Далее" To="ServiceClosed"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Заявитель получил результат</fs:Description>
                <fs:MfcServiceStatus>ServiceResultsReceived</fs:MfcServiceStatus>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="ServiceProcessingEnded2">
        <Transition Title="Далее" To="ServiceClosed"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Результат не будет выдан. Ошибка при отправке</fs:Description>
                <fs:MfcServiceStatus>ServiceProcessingEnded</fs:MfcServiceStatus>
                <fs:MfcServiceStatusAttribute Uid="87">0</fs:MfcServiceStatusAttribute>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="ServiceClosed">
        <Transition Title="Далее" To="null"/>
        <Data xmlns:fs="http://www.netvoxlab.ru/ReDoc/Workflow/FileDataSetter" xsi:type="fs:FileDataSetterData">
            <fs:CommonInfo>
                <fs:Description>Дело закрыто</fs:Description>
                <fs:MfcServiceStatus>ServiceClosed</fs:MfcServiceStatus>
                <fs:MfcServiceStatusAttribute Uid="183"><![CDATA[#set ($Newtrue = 'true')#set ($DueDate = ${FileInfo.DueDateTime.ToString("%tyyyy-%tMM-%tdd")})
#set ($NewDate = ${DateNow.substring(0,10)})
#if($NewDate.compareTo($DueDate)<= 0)false#else$Newtrue#end]]></fs:MfcServiceStatusAttribute>
            </fs:CommonInfo>
        </Data>
    </Step>
    <Step Name="vt_xsd">
        <Transition Title="Далее" To="null"/>
        <Data xmlns:vt="http://www.netvoxlab.ru/ReDoc/Workflow/VelocityTemplate" xsi:type="vt:VelocityTemplateData">
            <vt:Template>
<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<!-- Здесь вставьте содержимое velocity_xsd.xml -->
]]>            </vt:Template>
            <vt:Encoding>Utf8</vt:Encoding>
            <vt:OutputAttach>velocity_xsd.xml</vt:OutputAttach>
        </Data>
    </Step>
</Process>